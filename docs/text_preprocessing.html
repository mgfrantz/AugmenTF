---

title: Text Preprocessing

keywords: fastai
sidebar: home_sidebar

summary: "Module for preprocessing text. "
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 02_text_preprocessing.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>WARNING:tensorflow:Falling back to tensorflow client, its recommended to install the cloud tpu client directly with pip install cloud-tpu-client .
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="spec_add_spaces" class="doc_header"><code>spec_add_spaces</code><a href="https://github.com/mgfrantz/AugmenTF/tree/master/AugmenTF/text/text_preprocessing.py#L45" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>spec_add_spaces</code>(<strong><code>t</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Add spaces around / and # in <code>t</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="separate_punctuation" class="doc_header"><code>separate_punctuation</code><a href="https://github.com/mgfrantz/AugmenTF/tree/master/AugmenTF/text/text_preprocessing.py#L49" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>separate_punctuation</code>(<strong><code>string</code></strong>)</p>
</blockquote>
<p>Adds spaces around all punctuation.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="rm_useless_spaces" class="doc_header"><code>rm_useless_spaces</code><a href="https://github.com/mgfrantz/AugmenTF/tree/master/AugmenTF/text/text_preprocessing.py#L56" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>rm_useless_spaces</code>(<strong><code>t</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Remove multiple spaces in <code>t</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="replace_rep" class="doc_header"><code>replace_rep</code><a href="https://github.com/mgfrantz/AugmenTF/tree/master/AugmenTF/text/text_preprocessing.py#L60" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>replace_rep</code>(<strong><code>string</code></strong>)</p>
</blockquote>
<p>Replace repetitions at the character level in <code>string</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="replace_wrep" class="doc_header"><code>replace_wrep</code><a href="https://github.com/mgfrantz/AugmenTF/tree/master/AugmenTF/text/text_preprocessing.py#L68" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>replace_wrep</code>(<strong><code>t</code></strong>)</p>
</blockquote>
<p>Replace word repetitions in <code>t</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fix_html" class="doc_header"><code>fix_html</code><a href="https://github.com/mgfrantz/AugmenTF/tree/master/AugmenTF/text/text_preprocessing.py#L76" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fix_html</code>(<strong><code>x</code></strong>)</p>
</blockquote>
<p>List of replacements from html strings in <code>x</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="replace_all_caps" class="doc_header"><code>replace_all_caps</code><a href="https://github.com/mgfrantz/AugmenTF/tree/master/AugmenTF/text/text_preprocessing.py#L86" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>replace_all_caps</code>(<strong><code>x</code></strong>)</p>
</blockquote>
<p>Replace tokens in ALL CAPS in <code>x</code> by their lower version and add <a href="text.preprocessing.html#TK_UP"><code>TK_UP</code></a> before.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="deal_caps" class="doc_header"><code>deal_caps</code><a href="https://github.com/mgfrantz/AugmenTF/tree/master/AugmenTF/text/text_preprocessing.py#L94" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>deal_caps</code>(<strong><code>x</code></strong>)</p>
</blockquote>
<p>Replace all Capitalized tokens in <code>x</code> by their lower version and add <a href="text.preprocessing.html#TK_MAJ"><code>TK_MAJ</code></a> before.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fix_ascii" class="doc_header"><code>fix_ascii</code><a href="https://github.com/mgfrantz/AugmenTF/tree/master/AugmenTF/text/text_preprocessing.py#L103" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fix_ascii</code>(<strong><code>string</code></strong>)</p>
</blockquote>
<p>Fixes any ascii characters that may be in the text.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="preprocess_text" class="doc_header"><code>preprocess_text</code><a href="https://github.com/mgfrantz/AugmenTF/tree/master/AugmenTF/text/text_preprocessing.py#L111" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>preprocess_text</code>(<strong><code>string</code></strong>, <strong><code>funcs</code></strong>=<em><code>[&lt;function fix_html at 0x1424a6950&gt;, &lt;function replace_rep at 0x1424a6840&gt;, &lt;function replace_wrep at 0x1424a68c8&gt;, &lt;function separate_punctuation at 0x1424a21e0&gt;, &lt;function rm_useless_spaces at 0x1424a67b8&gt;, &lt;function replace_all_caps at 0x1424a69d8&gt;, &lt;function deal_caps at 0x1424a6a60&gt;]</code></em>)</p>
</blockquote>
<p>General function for cleaning text.
Applites functions in order to a string.</p>
<p>Options:</p>
<p>string: string you want to process for tokenization.
funcs: list, series of ordered functions you'd like to apply to string.</p>
<p>Returns:</p>
<p>string, text that's been processed by funcs.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These functions help clean text. They are largely taken from fastai.text.transform. They perform some basic text cleaning functionality.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preprocess_text</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Hello!</span><span class="se">\n</span><span class="s1">This is an example of how to #clean text up a bit...</span>
<span class="s1">aaaaa AAA</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;hello ! \n this is an example of how to # clean text up a bit . . . \n xxrep 5 a aaa&#39;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BaseTokenizer" class="doc_header"><code>class</code> <code>BaseTokenizer</code><a href="https://github.com/mgfrantz/AugmenTF/tree/master/AugmenTF/text/text_preprocessing.py#L128" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BaseTokenizer</code>(<strong><code>lang</code></strong>)</p>
</blockquote>
<p>Basic class for a tokenizer function.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SpacyTokenizer" class="doc_header"><code>class</code> <code>SpacyTokenizer</code><a href="https://github.com/mgfrantz/AugmenTF/tree/master/AugmenTF/text/text_preprocessing.py#L137" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SpacyTokenizer</code>(<strong><code>lang</code></strong>) :: <a href="text.preprocessing.html#BaseTokenizer"><code>BaseTokenizer</code></a></p>
</blockquote>
<p>Wrapper around a spacy tokenizer to make it a <a href="text.preprocessing.html#BaseTokenizer"><code>BaseTokenizer</code></a>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SentencePieceTokenizer" class="doc_header"><code>class</code> <code>SentencePieceTokenizer</code><a href="https://github.com/mgfrantz/AugmenTF/tree/master/AugmenTF/text/text_preprocessing.py#L149" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SentencePieceTokenizer</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trainer</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">SentencePieceTrainer</span><span class="o">.</span><span class="n">Train</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-12-730168baec58&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>trainer <span class="ansi-blue-fg">=</span> sps<span class="ansi-blue-fg">.</span>SentencePieceTrainer<span class="ansi-blue-fg">.</span>Train<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: SentencePieceTrainer_Train() takes exactly 1 argument (0 given)</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Blockers:</p>
<ul>
<li>regex does not support backreferences. This prevents implementation of some core functionality as a tf.function.</li>
</ul>

</div>
</div>
</div>
</div>
 

